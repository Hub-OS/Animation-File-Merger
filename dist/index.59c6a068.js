function t(t){return t&&t.__esModule?t.default:t}var e,r,o,n,i,a,s=globalThis,l={},h={},u=s.parcelRequire8aa8;null==u&&((u=function(t){if(t in l)return l[t].exports;if(t in h){var e=h[t];delete h[t];var r={id:t,exports:{}};return l[t]=r,e.call(r.exports,r,r.exports),r.exports}var o=Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(t,e){h[t]=e},s.parcelRequire8aa8=u);var f=u.register;f("12eZZ",function(t,e){var r,o;r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o={rotl:function(t,e){return t<<e|t>>>32-e},rotr:function(t,e){return t<<32-e|t>>>e},endian:function(t){if(t.constructor==Number)return 16711935&o.rotl(t,8)|4278255360&o.rotl(t,24);for(var e=0;e<t.length;e++)t[e]=o.endian(t[e]);return t},randomBytes:function(t){for(var e=[];t>0;t--)e.push(Math.floor(256*Math.random()));return e},bytesToWords:function(t){for(var e=[],r=0,o=0;r<t.length;r++,o+=8)e[o>>>5]|=t[r]<<24-o%32;return e},wordsToBytes:function(t){for(var e=[],r=0;r<32*t.length;r+=8)e.push(t[r>>>5]>>>24-r%32&255);return e},bytesToHex:function(t){for(var e=[],r=0;r<t.length;r++)e.push((t[r]>>>4).toString(16)),e.push((15&t[r]).toString(16));return e.join("")},hexToBytes:function(t){for(var e=[],r=0;r<t.length;r+=2)e.push(parseInt(t.substr(r,2),16));return e},bytesToBase64:function(t){for(var e=[],o=0;o<t.length;o+=3)for(var n=t[o]<<16|t[o+1]<<8|t[o+2],i=0;i<4;i++)8*o+6*i<=8*t.length?e.push(r.charAt(n>>>6*(3-i)&63)):e.push("=");return e.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var e=[],o=0,n=0;o<t.length;n=++o%4)0!=n&&e.push((r.indexOf(t.charAt(o-1))&Math.pow(2,-2*n+8)-1)<<2*n|r.indexOf(t.charAt(o))>>>6-2*n);return e}},t.exports=o}),f("a74v9",function(t,e){var r={utf8:{stringToBytes:function(t){return r.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(r.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var e=[],r=0;r<t.length;r++)e.push(255&t.charCodeAt(r));return e},bytesToString:function(t){for(var e=[],r=0;r<t.length;r++)e.push(String.fromCharCode(t[r]));return e.join("")}}};t.exports=r}),f("7B5Ea",function(t,e){function r(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */t.exports=function(t){return null!=t&&(r(t)||"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&r(t.slice(0,0))||!!t._isBuffer)}}),a=function(t){var e=t[0],r="'"===e;return t.substring(1,t.length-1).replace(/\\\\/g,"\\").replace(r?/\\'/g:/\\"/g,e)};const d=/\S/g,c=/[\s=]/g;function m(t,e,r){return e.lastIndex=r,e.exec(t)}function g(t,e){let r;let o={},n=t.indexOf(" ");if(n<0)return o;for(;r=m(t,d,n);){if(!(r=m(t,c,n=r.index)))throw Error(`Unexpected "${t.slice(n)}" on line ${e}`);let i=t.slice(n,r.index),s=t.indexOf("=",r.index);if(s<0)throw Error(`Attribute is missing "=" on line ${e}`);if(!(r=m(t,d,s+1)))throw Error(`Attribute is missing value on line ${e}`);let l=r.index,h="";if('"'==t[l]){let r=function(t,e){for(;;){if((e=t.indexOf('"',e))<0)return -1;if(!function(t,e){let r=!1;for(;e>0&&"\\"==t[e-=1];)r=!r;return r}(t,e))break;e+=1}return e}(t,l+1);if(r<0)throw Error(`String missing closing quote on line ${e}`);r+=1,h=a(t.slice(l,r)),n=r}else{let e=t.indexOf(" ",l);e<0&&(e=t.length),h=t.slice(l,e),n=e}o[i]=h}return o}function p(t,e,r={quoteAllValues:!0}){let o=[t];for(let t in e){let n=e[t],i=t;switch(r.renamedKeys&&(i=r.renamedKeys[t]||t),typeof n){case"string":""!=n&&((o.push(" "),o.push(i),o.push("="),r.quoteAllValues||n.includes('"')||n.includes(" "))?o.push('"'+n.replace(/\\|"/g,function(t){return"\\"+t})+'"'):o.push(n));break;case"number":0!=n&&(r.quoteAllValues?o.push(` ${i}="${n}"`):o.push(` ${i}=${n}`));break;case"boolean":!0==n&&(o.push(" "),o.push(i),r.quoteAllValues?o.push('="1"'):o.push("=1"));break;case"object":if(Array.isArray(n))break;default:throw Error(`Unexpected ${typeof n} for ${i}`)}}return o.join("")}function y(t){let e=[],r={quoteAllValues:!0};for(let o of("modern"==t.version&&(r.quoteAllValues=!1,r.renamedKeys={duration:"dur"}),t.animations)){for(let n of("modern"==t.version?e.push("anim "+o.state):e.push(p("animation",o,r)),o.frames))for(let t of(e.push(p("frame",n,r)),n.points))e.push(p("point",t,r));e.push("")}return e.join("\n")}var w={},x={},v=function(){};v.prototype={fit:function(t){var e,r,o,n,i=t.length,a=i>0?t[0].width:0,s=i>0?t[0].height:0;for(e=0,this.root={x:0,y:0,width:a,height:s};e<i;e++)o=t[e],n=(r=this.findNode(this.root,o.width,o.height))?this.splitNode(r,o.width,o.height):this.growNode(o.width,o.height),o.x=n.x,o.y=n.y},findNode:function(t,e,r){return t.used?this.findNode(t.right,e,r)||this.findNode(t.down,e,r):e<=t.width&&r<=t.height?t:null},splitNode:function(t,e,r){return t.used=!0,t.down={x:t.x,y:t.y+r,width:t.width,height:t.height-r},t.right={x:t.x+e,y:t.y,width:t.width-e,height:r},t},growNode:function(t,e){var r=t<=this.root.width,o=e<=this.root.height,n=o&&this.root.height>=this.root.width+t,i=r&&this.root.width>=this.root.height+e;return n?this.growRight(t,e):i?this.growDown(t,e):o?this.growRight(t,e):r?this.growDown(t,e):null},growRight:function(t,e){var r;return(this.root={used:!0,x:0,y:0,width:this.root.width+t,height:this.root.height,down:this.root,right:{x:this.root.width,y:0,width:t,height:this.root.height}},r=this.findNode(this.root,t,e))?this.splitNode(r,t,e):null},growDown:function(t,e){var r;return(this.root={used:!0,x:0,y:0,width:this.root.width,height:this.root.height+e,down:{x:0,y:this.root.height,width:this.root.width,height:e},right:this.root},r=this.findNode(this.root,t,e))?this.splitNode(r,t,e):null}},x=v,w=function(t,e){e=e||{};var r=new x,o=e.inPlace||!1,n=t.map(function(t){return o?t:{width:t.width,height:t.height,item:t}});n=n.sort(function(t,e){return e.width*e.height-t.width*t.height}),r.fit(n);var i={width:n.reduce(function(t,e){return Math.max(t,e.x+e.width)},0),height:n.reduce(function(t,e){return Math.max(t,e.y+e.height)},0)};return o||(i.items=n),i};var b={};function E(t,e,r,o){let n=t[e];for(let i of(n||(n=[],t[e]=n),n))if(i.frames[0].w==r.w&&i.frames[0].h==r.h&&function(t,e){return t&&e?t.data.every((t,r)=>t==e.data[r]):!t&&!e}(i.imageData,o))return i}function F(e,r,o){let n=r.getContext("2d"),i={};for(let e of o)for(let r of e.frames){if(0==r.w&&0==r.h)continue;let e=n.getImageData(r.x,r.y,r.w,r.h),o=t(b)(e.data),a=E(i,o,r,e);if(!a){let o=n.getImageData(r.x,r.y,r.w,r.h);for(let t=0;t<r.h;t++)for(let n=0;n<r.w;n++){let i=(t*r.w+n)*4,a=(t*r.w+(r.w-n-1))*4;for(let t=0;t<4;t++)o.data[i+t]=e.data[a+t]}(a=E(i,t(b)(o.data),r,o))&&(r.flipx=!r.flipx,r.originx=r.w-r.originx)}a?a.frames.push(r):i[o].push({frames:[r],imageData:e,width:r.w+2,height:r.h+2})}let a=Object.values(i).flat(),s=t(w)(a);e.width=s.width,e.height=s.height;let l=e.getContext("2d");for(let t of s.items){let{frames:e}=t.item,o=t.item.frames[0],n=t.x+1,i=t.y+1;for(let t of(l.drawImage(r,o.x,o.y,o.w,o.h,n,i,o.w,o.h),e))t.x=n,t.y=i}return o}e=u("12eZZ"),r=u("a74v9").utf8,o=u("7B5Ea"),n=u("a74v9").bin,(i=function(t,a){t.constructor==String?t=a&&"binary"===a.encoding?n.stringToBytes(t):r.stringToBytes(t):o(t)?t=Array.prototype.slice.call(t,0):Array.isArray(t)||t.constructor===Uint8Array||(t=t.toString());for(var s=e.bytesToWords(t),l=8*t.length,h=1732584193,u=-271733879,f=-1732584194,d=271733878,c=0;c<s.length;c++)s[c]=(s[c]<<8|s[c]>>>24)&16711935|(s[c]<<24|s[c]>>>8)&4278255360;s[l>>>5]|=128<<l%32,s[(l+64>>>9<<4)+14]=l;for(var m=i._ff,g=i._gg,p=i._hh,y=i._ii,c=0;c<s.length;c+=16){var w=h,x=u,v=f,b=d;h=m(h,u,f,d,s[c+0],7,-680876936),d=m(d,h,u,f,s[c+1],12,-389564586),f=m(f,d,h,u,s[c+2],17,606105819),u=m(u,f,d,h,s[c+3],22,-1044525330),h=m(h,u,f,d,s[c+4],7,-176418897),d=m(d,h,u,f,s[c+5],12,1200080426),f=m(f,d,h,u,s[c+6],17,-1473231341),u=m(u,f,d,h,s[c+7],22,-45705983),h=m(h,u,f,d,s[c+8],7,1770035416),d=m(d,h,u,f,s[c+9],12,-1958414417),f=m(f,d,h,u,s[c+10],17,-42063),u=m(u,f,d,h,s[c+11],22,-1990404162),h=m(h,u,f,d,s[c+12],7,1804603682),d=m(d,h,u,f,s[c+13],12,-40341101),f=m(f,d,h,u,s[c+14],17,-1502002290),u=m(u,f,d,h,s[c+15],22,1236535329),h=g(h,u,f,d,s[c+1],5,-165796510),d=g(d,h,u,f,s[c+6],9,-1069501632),f=g(f,d,h,u,s[c+11],14,643717713),u=g(u,f,d,h,s[c+0],20,-373897302),h=g(h,u,f,d,s[c+5],5,-701558691),d=g(d,h,u,f,s[c+10],9,38016083),f=g(f,d,h,u,s[c+15],14,-660478335),u=g(u,f,d,h,s[c+4],20,-405537848),h=g(h,u,f,d,s[c+9],5,568446438),d=g(d,h,u,f,s[c+14],9,-1019803690),f=g(f,d,h,u,s[c+3],14,-187363961),u=g(u,f,d,h,s[c+8],20,1163531501),h=g(h,u,f,d,s[c+13],5,-1444681467),d=g(d,h,u,f,s[c+2],9,-51403784),f=g(f,d,h,u,s[c+7],14,1735328473),u=g(u,f,d,h,s[c+12],20,-1926607734),h=p(h,u,f,d,s[c+5],4,-378558),d=p(d,h,u,f,s[c+8],11,-2022574463),f=p(f,d,h,u,s[c+11],16,1839030562),u=p(u,f,d,h,s[c+14],23,-35309556),h=p(h,u,f,d,s[c+1],4,-1530992060),d=p(d,h,u,f,s[c+4],11,1272893353),f=p(f,d,h,u,s[c+7],16,-155497632),u=p(u,f,d,h,s[c+10],23,-1094730640),h=p(h,u,f,d,s[c+13],4,681279174),d=p(d,h,u,f,s[c+0],11,-358537222),f=p(f,d,h,u,s[c+3],16,-722521979),u=p(u,f,d,h,s[c+6],23,76029189),h=p(h,u,f,d,s[c+9],4,-640364487),d=p(d,h,u,f,s[c+12],11,-421815835),f=p(f,d,h,u,s[c+15],16,530742520),u=p(u,f,d,h,s[c+2],23,-995338651),h=y(h,u,f,d,s[c+0],6,-198630844),d=y(d,h,u,f,s[c+7],10,1126891415),f=y(f,d,h,u,s[c+14],15,-1416354905),u=y(u,f,d,h,s[c+5],21,-57434055),h=y(h,u,f,d,s[c+12],6,1700485571),d=y(d,h,u,f,s[c+3],10,-1894986606),f=y(f,d,h,u,s[c+10],15,-1051523),u=y(u,f,d,h,s[c+1],21,-2054922799),h=y(h,u,f,d,s[c+8],6,1873313359),d=y(d,h,u,f,s[c+15],10,-30611744),f=y(f,d,h,u,s[c+6],15,-1560198380),u=y(u,f,d,h,s[c+13],21,1309151649),h=y(h,u,f,d,s[c+4],6,-145523070),d=y(d,h,u,f,s[c+11],10,-1120210379),f=y(f,d,h,u,s[c+2],15,718787259),u=y(u,f,d,h,s[c+9],21,-343485551),h=h+w>>>0,u=u+x>>>0,f=f+v>>>0,d=d+b>>>0}return e.endian([h,u,f,d])})._ff=function(t,e,r,o,n,i,a){var s=t+(e&r|~e&o)+(n>>>0)+a;return(s<<i|s>>>32-i)+e},i._gg=function(t,e,r,o,n,i,a){var s=t+(e&o|r&~o)+(n>>>0)+a;return(s<<i|s>>>32-i)+e},i._hh=function(t,e,r,o,n,i,a){var s=t+(e^r^o)+(n>>>0)+a;return(s<<i|s>>>32-i)+e},i._ii=function(t,e,r,o,n,i,a){var s=t+(r^(e|~o))+(n>>>0)+a;return(s<<i|s>>>32-i)+e},i._blocksize=16,i._digestsize=16,b=function(t,r){if(null==t)throw Error("Illegal argument "+t);var o=e.wordsToBytes(i(t,r));return r&&r.asBytes?o:r&&r.asString?n.bytesToString(o):e.bytesToHex(o)};const I=document.getElementById("sheet-list");function T(t){let e=document.getElementById("sheet-list-item-template");for(let r of(I.textContent="",t.sheets)){let o=e.content.cloneNode(!0);if(o.querySelector(".sheet-name").innerText=r.name,!r.image||!r.animations){let t=o.querySelector(".error-text");r.animationError?t.innerText=r.animationError:r.imageError?t.innerText=r.imageError:r.animations?r.image||(t.innerText="Missing image file"):t.innerText="Missing .animation file"}o.querySelector(".remove-file-button").onclick=function(){t.remove(r.name),T(t)},I.appendChild(o)}}const A=new class{resolveOutputVersion(){return this.sheets.some(t=>t.boomsheet?.version=="modern")?"modern":"legacy"}findOrInsert(t){let e=this.sheets.find(e=>e.name==t);return e||(e={name:t},this.sheets.push(e)),e}remove(t){let e=this.sheets.findIndex(e=>e.name==t);this.sheets.splice(e,1)}constructor(){this.sheets=[]}};function B(t){console.error(t),alert(t)}async function S(t){for(let r of t){var e;let t=(e=r.name).slice(0,e.lastIndexOf(".")),o=A.findOrInsert(t);if(r.name.endsWith(".png"))try{o.image=await function(t){return new Promise((e,r)=>{let o=new FileReader;o.onload=function(){let n=new Image;n.src=o.result,n.onload=function(){e(n)},n.onerror=function(){r(Error(`Failed to load "${t.name}"`))}},o.onerror=function(){r(Error(`Failed to load "${t.name}: ${o.error}"`))},o.readAsDataURL(t)})}(r),o.imageError=void 0}catch(t){console.error(t),o.imageError=t.toString()}else if(r.name.endsWith(".animation")||r.name.endsWith(".anim"))try{let t=await function(t){return new Promise((e,r)=>{let o=new FileReader;o.onload=function(){e(o.result)},o.onerror=function(){r(Error(`Failed to load "${t.name}: ${o.error}"`))},o.readAsText(t)})}(r);o.boomsheet=function(t){let e,r;let o=[],n={version:"modern",animations:o},i=0;for(let a of t.split("\n"))if(a=a.trim(),i+=1,!(""==a||a.startsWith("#")||a.startsWith("!")||a.startsWith("imagePath")||a.startsWith("version"))){if(a.startsWith("anim ")){let t={state:a.slice(5).trim(),frames:[]};o.push(t),e=t}else if(a.startsWith("animation ")){n.version="legacy";let t=g(a,i),r={state:t.state,frames:[]};if(!t.state)throw Error(`Animation is missing state name on line ${i}`);o.push(r),e=r}else if(a.startsWith("frame")||a.startsWith("blank")){if(!e)throw Error(`No animation state to associate frame with on line ${i}`);let t=g(a,i),o={x:parseFloat(t.x)||0,y:parseFloat(t.y)||0,w:parseFloat(t.w)||0,h:parseFloat(t.h)||0,originx:parseFloat(t.originx)||0,originy:parseFloat(t.originy)||0,flipx:1==parseInt(t.flipx),flipy:1==parseInt(t.flipy),duration:t.duration||t.dur||"",points:[]};e.frames.push(o),r=o}else if(a.startsWith("point ")){if(!r)throw Error(`No frame to associate point with on line ${i}`);let t=g(a,i);if(!t.label)throw Error(`Point is missing label on line ${i}`);let e={label:t.label,x:parseFloat(t.x),y:parseFloat(t.y)};r.points.push(e)}else{let t=a.indexOf(" "),e=t<0?a:a.slice(0,t);throw Error(`Unexpected "${e}" on line ${i}`)}}return n}(t),o.animations=o.boomsheet.animations,o.animationError=void 0}catch(t){console.error(t),o.animationError=t.toString()}}}document.getElementById("clear-button").onclick=function(){A.sheets=[],T(A)},document.getElementById("overlay-button").onclick=function(){let e=document.querySelector("#output canvas"),r=document.querySelector("#output textarea");try{let o=document.createElement("canvas"),n=function(e,r){let o={};for(let t=0;t<r.sheets.length;t++){let e=r.sheets[t];if(e.animations&&e.image)for(let r of e.animations){let e=o[r.state];e||(e=[],o[r.state]=e);let i=0;for(let o of r.frames){var n;let r=((n=(n=o.duration).trim()).toLowerCase().endsWith("f")?parseFloat(n.slice(0,-1))/60:parseFloat(n))||0,a=0==r;for(;a||r>0;){a=!1;let n=e[i];if(i+=1,!n){let n=e[e.length-1]?.overlayed||[];e.push({overlayed:[...n.filter(({sheetIndex:e})=>e!=t),{sheetIndex:t,frame:o}],outFrame:{x:0,y:0,w:o.w,h:o.h,originx:o.originx,originy:o.originy,flipx:!1,flipy:!1,duration:"",points:[]},duration:r,width:0,height:0});break}if(n.duration>r){let t=structuredClone(n);t.duration-=r,e.splice(i,0,t),n.duration=r}r-=n.duration,n.overlayed.push({sheetIndex:t,frame:o})}}let a=r.frames[r.frames.length-1];if(a)for(;i<e.length;i++)e[i].overlayed.push({sheetIndex:t,frame:a})}}let i=Object.values(o).flat();for(let t of i){for(let{frame:e}of t.overlayed)t.outFrame.originx=Math.max(t.outFrame.originx,e.originx),t.outFrame.originy=Math.max(t.outFrame.originy,e.originy);for(let{frame:e}of t.overlayed){let r=t.outFrame.originx-e.originx,o=t.outFrame.originy-e.originy;for(let n of e.points)n=structuredClone(n),n.x+=r,n.y+=o,t.outFrame.points.push(n)}for(let{frame:e}of t.overlayed)t.outFrame.w=Math.max(t.outFrame.w,t.outFrame.originx-e.originx+e.w),t.outFrame.h=Math.max(t.outFrame.h,t.outFrame.originy-e.originy+e.h);t.width=t.outFrame.w+2,t.height=t.outFrame.h+2}let a=t(w)(i);e.width=a.width,e.height=a.height;let s=e.getContext("2d");for(let t of a.items){let e=t.x+1,o=t.y+1,{outFrame:n}=t.item;for(let{sheetIndex:i,frame:a}of(n.x=e,n.y=o,n.duration=t.item.duration.toString(),t.item.overlayed)){let t=r.sheets[i].image;if(!t)continue;let e=n.x+n.originx-a.originx,o=n.y+n.originy-a.originy;s.save(),s.translate(e,o),a.flipx&&(s.translate(a.w,0),s.scale(-1,1)),a.flipy&&(s.translate(a.h,0),s.scale(1,-1)),s.drawImage(t,a.x,a.y,a.w,a.h,0,0,a.w,a.h),s.restore()}}return Object.entries(o).map(([t,e])=>({state:t,frames:e.map(t=>t.outFrame)}))}(o,A);F(e,o,n);let i={version:A.resolveOutputVersion(),animations:n};r.value=y(i)}catch(t){B(t)}},document.getElementById("merge-button").onclick=function(){let e=document.querySelector("#output canvas"),r=document.querySelector("#output textarea");try{let o=document.createElement("canvas"),n=function(e,r){let o=[],n=[];for(let t of r.sheets){if(!t.animations||!t.image)continue;let e=structuredClone(t.animations);for(let r of(o.push(...e),e))for(let e of r.frames)0!=e.w&&0!=e.h&&n.push({image:t.image,frame:e,width:e.w+2,height:e.h+2})}let i=t(w)(n);e.width=i.width,e.height=i.height;let a=e.getContext("2d");for(let t of i.items){let e=t.item.frame,r=t.x+1,o=t.y+1;a.drawImage(t.item.image,e.x,e.y,e.w,e.h,r,o,e.w,e.h),e.x=r,e.y=o}return o}(o,A);F(e,o,n);let i={version:A.resolveOutputVersion(),animations:n};r.value=y(i)}catch(t){B(t)}},document.body.addEventListener("dragover",t=>t.preventDefault()),document.body.addEventListener("drop",t=>{let e=t.dataTransfer?.items;if(!e)return;t.preventDefault();let r=[];for(let t of e){let e=t.getAsFile();e&&r.push(e)}S(r).catch(B).finally(()=>{T(A)})});
//# sourceMappingURL=index.59c6a068.js.map
