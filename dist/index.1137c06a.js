n=function(t){var e=t[0],i="'"===e;return t.substring(1,t.length-1).replace(/\\\\/g,"\\").replace(i?/\\'/g:/\\"/g,e)};const t=/\S/g,e=/[\s=]/g;function i(t,e,i){return e.lastIndex=i,e.exec(t)}function r(r,o){let s;let h={},a=r.indexOf(" ");if(a<0)return h;for(;s=i(r,t,a);){if(!(s=i(r,e,a=s.index)))throw Error(`Unexpected "${r.slice(a)}" on line ${o}`);let l=r.slice(a,s.index),u=r.indexOf("=",s.index);if(u<0)throw Error(`Attribute is missing "=" on line ${o}`);if(!(s=i(r,t,u+1)))throw Error(`Attribute is missing value on line ${o}`);let f=s.index,d="";if('"'==r[f]){let t=function(t,e){for(;;){if((e=t.indexOf('"',e))<0)return -1;if(!function(t,e){let i=!1;for(;e>0&&"\\"==t[e-=1];)i=!i;return i}(t,e))break;e+=1}return e}(r,f+1);if(t<0)throw Error(`String missing closing quote on line ${o}`);t+=1,d=n(r.slice(f,t)),a=t}else{let t=r.indexOf(" ",f);t<0&&(t=r.length),d=r.slice(f,t),a=t}h[l]=d}return h}function o(t,e,i={quoteAllValues:!0}){let r=[t];for(let t in e){let o=e[t];switch(typeof o){case"string":""!=o&&(r.push(" "),r.push(t),r.push("="),r.push('"'+o.replace(/\\|"/g,function(t){return"\\"+t})+'"'));break;case"number":0!=o&&(i.quoteAllValues?r.push(` ${t}="${o}"`):r.push(` ${t}=${o}`));break;case"boolean":!0==o&&(r.push(" "),r.push(t),i.quoteAllValues?r.push('="1"'):r.push("=1"));break;case"object":if(Array.isArray(o))break;default:throw Error(`Unexpected ${typeof o} for ${t}`)}}return r.join("")}var n,s={},h={},a=function(){};a.prototype={fit:function(t){var e,i,r,o,n=t.length,s=n>0?t[0].width:0,h=n>0?t[0].height:0;for(e=0,this.root={x:0,y:0,width:s,height:h};e<n;e++)r=t[e],o=(i=this.findNode(this.root,r.width,r.height))?this.splitNode(i,r.width,r.height):this.growNode(r.width,r.height),r.x=o.x,r.y=o.y},findNode:function(t,e,i){return t.used?this.findNode(t.right,e,i)||this.findNode(t.down,e,i):e<=t.width&&i<=t.height?t:null},splitNode:function(t,e,i){return t.used=!0,t.down={x:t.x,y:t.y+i,width:t.width,height:t.height-i},t.right={x:t.x+e,y:t.y,width:t.width-e,height:i},t},growNode:function(t,e){var i=t<=this.root.width,r=e<=this.root.height,o=r&&this.root.height>=this.root.width+t,n=i&&this.root.width>=this.root.height+e;return o?this.growRight(t,e):n?this.growDown(t,e):r?this.growRight(t,e):i?this.growDown(t,e):null},growRight:function(t,e){var i;return(this.root={used:!0,x:0,y:0,width:this.root.width+t,height:this.root.height,down:this.root,right:{x:this.root.width,y:0,width:t,height:this.root.height}},i=this.findNode(this.root,t,e))?this.splitNode(i,t,e):null},growDown:function(t,e){var i;return(this.root={used:!0,x:0,y:0,width:this.root.width,height:this.root.height+e,down:{x:0,y:this.root.height,width:this.root.width,height:e},right:this.root},i=this.findNode(this.root,t,e))?this.splitNode(i,t,e):null}},h=a,s=function(t,e){e=e||{};var i=new h,r=e.inPlace||!1,o=t.map(function(t){return r?t:{width:t.width,height:t.height,item:t}});o=o.sort(function(t,e){return e.width*e.height-t.width*t.height}),i.fit(o);var n={width:o.reduce(function(t,e){return Math.max(t,e.x+e.width)},0),height:o.reduce(function(t,e){return Math.max(t,e.y+e.height)},0)};return r||(n.items=o),n};const l=document.getElementById("sheet-list");function u(t){let e=document.getElementById("sheet-list-item-template");for(let i of(l.textContent="",t.sheets)){let r=e.content.cloneNode(!0);if(r.querySelector(".sheet-name").innerText=i.name,!i.image||!i.animations){let t=r.querySelector(".error-text");i.animationError?t.innerText=i.animationError:i.imageError?t.innerText=i.imageError:i.animations?i.image||(t.innerText="Missing image file"):t.innerText="Missing .animation file"}r.querySelector(".remove-file-button").onclick=function(){t.remove(i.name),u(t)},l.appendChild(r)}}const f=new class{findOrInsert(t){let e=this.sheets.find(e=>e.name==t);return e||(e={name:t},this.sheets.push(e)),e}remove(t){let e=this.sheets.findIndex(e=>e.name==t);this.sheets.splice(e,1)}constructor(){this.sheets=[]}};function d(t){console.error(t),alert(t)}async function c(t){for(let i of t){var e;let t=(e=i.name).slice(0,e.lastIndexOf(".")),o=f.findOrInsert(t);if(i.name.endsWith(".png"))try{o.image=await function(t){return new Promise((e,i)=>{let r=new FileReader;r.onload=function(){let o=new Image;o.src=r.result,o.onload=function(){e(o)},o.onerror=function(){i(Error(`Failed to load "${t.name}"`))}},r.onerror=function(){i(Error(`Failed to load "${t.name}: ${r.error}"`))},r.readAsDataURL(t)})}(i),o.imageError=void 0}catch(t){console.error(t),o.imageError=t.toString()}else if(i.name.endsWith(".animation"))try{let t=await function(t){return new Promise((e,i)=>{let r=new FileReader;r.onload=function(){e(r.result)},r.onerror=function(){i(Error(`Failed to load "${t.name}: ${r.error}"`))},r.readAsText(t)})}(i);o.animations=function(t){let e,i;let o=[],n=0;for(let s of t.split("\n"))if(s=s.trim(),n+=1,!(""==s||s.startsWith("#")||s.startsWith("imagePath")||s.startsWith("version"))){if(s.startsWith("animation ")){let t=r(s,n),i={state:t.state,frames:[]};if(!t.state)throw Error(`Animation is missing state name on line ${n}`);o.push(i),e=i}else if(s.startsWith("frame")||s.startsWith("blank")){if(!e)throw Error(`No animation state to associate frame with on line ${n}`);let t=r(s,n),o={x:parseFloat(t.x)||0,y:parseFloat(t.y)||0,w:parseFloat(t.w)||0,h:parseFloat(t.h)||0,originx:parseFloat(t.originx)||0,originy:parseFloat(t.originy)||0,flipx:1==parseInt(t.flipx),flipy:1==parseInt(t.flipy),duration:t.duration||"",points:[]};e.frames.push(o),i=o}else if(s.startsWith("point ")){if(!i)throw Error(`No frame to associate point with on line ${n}`);let t=r(s,n);if(!t.label)throw Error(`Point is missing label on line ${n}`);let e={label:t.label,x:parseFloat(t.x),y:parseFloat(t.y)};i.points.push(e)}else{let t=s.indexOf(" "),e=t<0?s:s.slice(0,t);throw Error(`Unexpected "${e}" on line ${n}`)}}return o}(t),o.animationError=void 0}catch(t){console.error(t),o.animationError=t.toString()}}}document.getElementById("clear-button").onclick=function(){f.sheets=[],u(f)},document.getElementById("merge-button").onclick=function(){let t=document.querySelector("#output canvas"),e=document.querySelector("#output textarea");try{let i=function(t,e){var i;let r=[],o=[];for(let t of e.sheets){if(!t.animations||!t.image)continue;let e=structuredClone(t.animations);for(let i of(r.push(...e),e))for(let e of i.frames)o.push({image:t.image,frame:e,width:e.w+2,height:e.h+2})}let n=((i=s)&&i.__esModule?i.default:i)(o);t.width=n.width,t.height=n.height;let h=t.getContext("2d");for(let t of n.items){let e=t.item.frame,i=t.x+1,r=t.y+1;h.drawImage(t.item.image,e.x,e.y,e.w,e.h,i,r,e.w,e.h),e.x=i,e.y=r}return r}(t,f);e.value=function(t){let e=[];for(let i of t){for(let t of(e.push(o("animation",i)),i.frames))for(let i of(e.push(o("frame",t)),t.points))e.push(o("point",i));e.push("")}return e.join("\n")}(i)}catch(t){d(t)}},document.body.addEventListener("dragover",t=>t.preventDefault()),document.body.addEventListener("drop",t=>{let e=t.dataTransfer?.items;if(!e)return;t.preventDefault();let i=[];for(let t of e){let e=t.getAsFile();e&&i.push(e)}c(i).catch(d).finally(()=>{u(f)})});
//# sourceMappingURL=index.1137c06a.js.map
